---
layout: post
title : Using Bitcoin in Linux
categories: BlockChain
comments: true
image: 
description:
---


Bitcoin is the digital cryptocurrency system that uses blockchain technology. Digital currencies: E-cash, E-gold, WebMoney and many more were there before cryptocurrency, but due to the need for a central authority to be involved and manage trust to the system, any faliure such as bankruptcy or being held by authorites could simply create financial nightmare.
<!--continue-->
<br>
Thankfully, the progress of cryptography and the emergence of some clever solutions such as proof of work (for example, the hashcash Project—see http://hashcash.org) brought hope of breaking the deadlock.
<br><br>
Bitcoin, the new currency effectively harnessed cryptography techniques to manage ownership and to secure the system—hence the name cryptocurrency.



<h3>Running a bitcoin client for the first time</h3>

<p>A bitcoin client is the end-user software that allows us to perform bitcoin operations (sending transactions, receiving payments, and so on).

<br>2 common clients are: Bitcoin Core and Electrum. We will use Electrum for sending end and Bitcoin core at the receiving end.




<u>Installing Bitcoin Core</u>

<pre>
--wget https://bitcoincore.org/bin/bitcoin-core-0.15.2/bitcoin-0.15.2-x86_64-linux-gnu.tar.gz
--sudo install -m 0755 -o root -g root -t /usr/local/bin bitcoin-0.15.2/bin/*
</pre>







<h3>Synchronizing the Blockchain</h3>
<p>
 For to start sending and receiving the bitcoins, we need to synchronize the blockchain which is technically the transcation database which is well above (>200GB).

 <br>
 There are 2 workarounds for this:
 <ul>
	 <li>Enabling pruning for a full-node client such as Bitcoin Core</li>
	 <li>Using a thin (SPV) client such as Electrum, which fetches blockchain information from Electrum servers instead of having a local copy</li>
 </ul>
</p>


<h3>Running Bitcoin Core</h3>
<p>
	Under default dirctory .bitcoin/ , create bitcoin.conf  with following configurations:
  <table>
	<tr><td>rpcuser=user_name</td><td>#Username for JSON-RPC connections</td></tr>            
    <tr><td>rpcpassword=your_password</td><td>#Password Username for JSON-RPC connections</td></tr>
    <tr><td>server=1</td><td>#Tells Bitcoin-Qt and bitcoind to accept JSON-RPC commands</td></tr>
    <tr><td>testnet=1</td><td>#Run on the test network instead of the real bitcoin network.</td></tr>
    <tr><td>prune=550</td><td>#Enables pruning mode	</td></tr>

		
  </table>

  Start bitcoin using either of the 2 ways: 
  <pre>	
  bitcoin-qt  #it will start GUI interface connected to testnet.
  
  bitcoind --datadir=/mnt   #using bitcoin daemon in CLI mode 
  </pre>

  As the bitcoin starts, many subdirectories are created under .bitcoin directory.
  <pre>
  	blocks/     #stores actual bitcoin blocks
  	chainstate/  #Holds a LevelDB database for available UTXOs (short for Unspent Transaction Outputs)—in other 
  	              words, a database storing how much money everyone has
  	wallets/    #Contains an encrypted wallet.dat file, which stores the private keys
  </pre>


  <pre>
  	 bitcoin-cli -datadir=/mnt/.bitcoin/ getnewaddress
  </pre>


</p>




<h3>Electrum</h3>

<p>
<u>Installing Electrum: a lightweight wallet</u>
--sudo pacman -S electrum

<u>Starting Electrum in testnet mode for first time.</u>
-- electrum --testnet   #this will open GUI for wallet configuration

After the wallet is setup, <u>running electrum in CLI</u>
-- electrum --testnet daemon
-- electrum --testnet daemon load_wallet
-- electrum --testnet listaddresses

</p>


<h3>Building Raw Transaction using Bitcoin core</h3>

<p>
	Browse to the online faucet website at http://bitcoinfaucet.uo1.net/ or any other bitcoin's faucet websites, and get a few by providing the first address generated by Electrum and the address created by Bitcoin.


<u>Unspent transaction output</u>
<pre>
	bitcoin-cli -datadir=/mnt/.bitcoin/ listunspent    #return [] until the blocks are synchronized

	electrum --testnet listunspent


	//output
	{
        "address": "tb1qcvpv87c9s3xasr25tfg4n2d3sk66wlu3jfj4md",
        "coinbase": false,
        "height": 0,
        "prevout_hash": "709511b4b7502ccff224227d0b8c086a3a1310bac9fb655a39ea1074d1310981",
        "prevout_n": 0,
        "value": "0.0007"
    }              
</pre>


<u>Creating the transaction</u>

<pre>
bitcoin-cli -datadir=/mnt/.bitcoin/  createrawtransaction "[{\"txid\":\"709511b4b7502ccff224227d0b8c086a3a1310bac9fb655a39ea1074d1310981\",\"vout\":0}]" "{\"data\":\"48656c6c6f20576f726c64\",\"tb1qcvpv87c9s3xasr25tfg4n2d3sk66wlu3jfj4md\":1.0000000}"

/output
0200000001810931d17410ea395a65fbc9ba10133a6a088c0b7d2224f2cf2c50b7b41195700000000000ffffffff0200000000000000000d6a0b48656c6c6f20576f726c6400e1f50500000000160014c302c3fb05844dd80d545a5159a9b185b5a77f9100000000
	
</pre>

1. The txid of one of the available outputs 
2. The  voutindex (prevout_n for Electrum) of the selected output
3. The hexadecimal form of the message
4. The destination address (created earlier)
5. The total number of satoshis (the smallest unit of the bitcoin currency) to send

</p>





### Decode the RawTransaction

<pre>
--bitcoin-cli -datadir=/mnt/.bitcoin/ decoderawtransaction [HEX VALUE]

or

--electrum --testnet deserialize [HEXVALUE]

//output
{
    "inputs": [
        {
            "address": null,
            "num_sig": 0,
            "prevout_hash": "709511b4b7502ccff224227d0b8c086a3a1310bac9fb655a39ea1074d1310981",
            "prevout_n": 0,
            "pubkeys": [],
            "scriptSig": "",
            "sequence": 4294967295,
            "signatures": {},
            "type": "unknown",
            "x_pubkeys": []
        }
    ],
    "lockTime": 0,
    "outputs": [
        {
            "address": "6a0b48656c6c6f20576f726c64",
            "prevout_n": 0,
            "scriptPubKey": "6a0b48656c6c6f20576f726c64",
            "type": 2,
            "value": 0
        },
        {
            "address": "tb1qcvpv87c9s3xasr25tfg4n2d3sk66wlu3jfj4md",
            "prevout_n": 1,
            "scriptPubKey": "0014c302c3fb05844dd80d545a5159a9b185b5a77f91",
            "type": 0,
            "value": 100000000
        }
    ],
    "partial": false,
    "segwit_ser": false,
    "version": 2
}
</pre>



### Signing the Transaction

1. generate the private key

   Note: Beware, you should not share your private keys in real life. Remember that whoever has the private key can spend the received Bitcoins.

<pre>
--electrum --testnet listaddresses | electrum --testnet  getprivatekeys -
</pre>
Notice the presence of a dash at the end of the command. It will be replaced by the values returned from the pipe. As a result, you'll get a list of private keys. Copy the first one without the p2pkh prefix.



2. Retrieve the transaction from the blockchain --> getting scriptpubkey

<pre>
--electrum  gettransaction --testnet "709511b4b7502ccff224227d0b8c086a3a1310bac9fb655a39ea1074d1310981"
</pre>

3.  we use the resultant raw form to get scriptPubKey, as follows:
<pre>
	electrum deserialize --testnet [rawdata] 
</pre>